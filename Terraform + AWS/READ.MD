# ğŸš€ Provisionamento AWS com Terraform

## ğŸ“‹ Ãndice
- [PrÃ©-requisitos](#-prÃ©-requisitos)
- [ConfiguraÃ§Ã£o da Conta AWS](#-1-configuraÃ§Ã£o-da-conta-aws)
- [InstalaÃ§Ã£o Local](#-2-instalaÃ§Ã£o-local)
- [AutenticaÃ§Ã£o AWS](#-3-autenticaÃ§Ã£o-aws)
- [PreparaÃ§Ã£o do Projeto](#-4-preparaÃ§Ã£o-do-projeto)
- [ExecuÃ§Ã£o do Terraform](#-5-execuÃ§Ã£o-do-terraform)
- [VerificaÃ§Ãµes](#-6-verificaÃ§Ãµes)
- [Tratativa de Erros](#-7-tratativa-de-erros-comuns)
- [DestruiÃ§Ã£o dos Recursos](#-8-destruiÃ§Ã£o-dos-recursos)
- [ObservaÃ§Ãµes](#-observaÃ§Ãµes)

## âœ… PrÃ©-requisitos

- [ ] Conta AWS criada e ativa  
- [ ] Acesso root ou IAM com permissÃµes administrativas temporÃ¡rias  

---

## ğŸ” 1. ConfiguraÃ§Ã£o da Conta AWS

### Criar conta AWS

1. Acesse: [https://console.aws.amazon.com](https://console.aws.amazon.com)  
2. Complete o cadastro  
3. Ative a **verificaÃ§Ã£o em duas etapas**

### Criar usuÃ¡rio IAM com permissÃµes especÃ­ficas (recomendado)

1. Acesse **IAM Console** > **Users**  
2. Selecione seu usuÃ¡rio > **Add permissions** > **Attach policies directly**

#### PermissÃµes mÃ­nimas recomendadas:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:RunInstances",
        "ec2:CreateSecurityGroup",
        "ec2:Describe*",
        "ec2:TerminateInstances",
        "iam:CreateKeyPair"
      ],
      "Resource": "*"
    }
  ]
}
```

> **Nota**: Alternativamente, vocÃª pode usar a polÃ­tica gerenciada `AmazonEC2FullAccess` (menos segura, mas rÃ¡pida para testes).

## ğŸ’» 2. InstalaÃ§Ã£o Local

### Terraform

#### Linux (Debian/Ubuntu)
```bash
curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
sudo apt update && sudo apt install terraform
```

#### Windows (via Chocolatey)
```powershell
choco install terraform
```

#### SoluÃ§Ã£o para erro de repositÃ³rio
Se ocorrer erro do tipo:
```
E: Malformed entry 1 in list file /etc/apt/sources.list.d/hashicorp.list (Component)
E: The list of sources could not be read.
```

Execute:
```bash
wget https://releases.hashicorp.com/terraform/1.6.4/terraform_1.6.4_linux_amd64.zip
unzip terraform_*.zip
sudo mv terraform /usr/local/bin/
terraform --version
```

### AWS CLI

#### Linux
```bash
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
```

#### Windows
```powershell
msiexec.exe /i https://awscli.amazonaws.com/AWSCLIV2.msi /quiet
```
> **Nota**: Esse comando Ã© usado para instalar silenciosamente a AWS CLI no Windows sem intervenÃ§Ã£o do usuÃ¡rio.

## ğŸ”‘ 3. AutenticaÃ§Ã£o AWS

1. Configure suas credenciais:
```bash
aws configure
```

2. Preencha as informaÃ§Ãµes:
- AWS Access Key ID
- AWS Secret Access Key
- Default region: us-east-1
- Default output: json

3. Teste o acesso:
```bash
# Listar buckets S3
aws s3 ls

# Verificar identidade
aws sts get-caller-identity
```

> **Dica**: Se receber erro "Unable to locate credentials", verifique se a AWS CLI estÃ¡ funcionando corretamente.

## ğŸ“‚ 4. PreparaÃ§Ã£o do Projeto

### Estrutura de arquivos
```plaintext
/
â”œâ”€â”€ main.tf          # ConfiguraÃ§Ã£o do provider
â”œâ”€â”€ ec2.tf           # InstÃ¢ncia EC2
â”œâ”€â”€ security-group.tf # Regras de seguranÃ§a
â”œâ”€â”€ script.sh        # User data (Apache/Nginx)
â””â”€â”€ outputs.tf       # IP pÃºblico e outros outputs
```

## ğŸš€ 5. ExecuÃ§Ã£o do Terraform

### InicializaÃ§Ã£o
```bash
terraform init
```

### Planejamento
```bash
terraform plan
```
> Verifique se 1 EC2 instance e 1 Security Group serÃ£o criados

### AplicaÃ§Ã£o
```bash
terraform apply
```
> Confirme com 'yes' quando solicitado

## âœ”ï¸ 6. VerificaÃ§Ãµes

1. Acesse o Console AWS > EC2
2. Confirme:
   - InstÃ¢ncia com tag Name = Web Server
   - Status running
3. Teste de conexÃ£o:
```bash
curl http://$(terraform output -raw public_ip)
```

## ğŸ’¥ 7. Tratativa de Erros Comuns

### InvalidKeyPair.NotFound
```bash
aws ec2 create-key-pair --key-name terraform-key --query 'KeyMaterial' --output text > ~/.ssh/terraform-key.pem
chmod 400 ~/.ssh/terraform-key.pem
```

### UnauthorizedOperation
Adicione ao usuÃ¡rio IAM:
```json
{
    "Effect": "Allow",
    "Action": "ec2:CreateSecurityGroup",
    "Resource": "*"
}
```

## ğŸ§¹ 8. DestruiÃ§Ã£o dos Recursos

```bash
terraform destroy
```
> âš ï¸ Execute `terraform destroy` SOMENTE apÃ³s registrar todas as evidÃªncias

## ğŸ“ ObservaÃ§Ãµes

1. **Key Pair**: Substitua `terraform-key` pelo nome da sua chave existente ou use o bloco `aws_key_pair` no Terraform  
2. **RegiÃ£o**: Verifique se todos os recursos estÃ£o na mesma regiÃ£o (`us-east-1`)  
3. **SeguranÃ§a**: Para ambientes reais, restrinja o acesso SSH no Security Group  

---

## ğŸ”— Links Ãšteis

- [RepositÃ³rio do ExercÃ­cio](https://github.com/luizcarlos16/bt-dvp-v2-terraform)
- [DocumentaÃ§Ã£o AWS](https://docs.aws.amazon.com/)
- [DocumentaÃ§Ã£o Terraform](https://www.terraform.io/docs)
